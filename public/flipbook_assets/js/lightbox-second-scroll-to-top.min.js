!(function (a, b) {
    'function' == typeof define && define.amd ?
        define(['jquery'], b) :
        'object' == typeof exports ?
            (module.exports = b(require('jquery'))) :
            (a.lightbox = b(a.jQuery));
})(this, function (a) {
    function b(b) {
        (this.album = []),
            (this.currentImageIndex = void 0),
            this.init(),
            (this.options = a.extend({}, this.constructor.defaults)),
            this.option(b);
    }

    return (
        (b.defaults = {
            albumLabel: 'Image %1 of %2',
            alwaysShowNavOnTouchDevices: !1,
            fadeDuration: 600,
            fitImagesInViewport: !0,
            imageFadeDuration: 600,
            positionFromTop: 50,
            resizeDuration: 700,
            showImageNumberLabel: !0,
            wrapAround: !1,
            disableScrolling: !1,
            sanitizeTitle: !1,
        }),
            (b.prototype.option = function (b) {
                a.extend(this.options, b);
            }),
            (b.prototype.imageCountLabel = function (a, b) {
                return this.options.albumLabel.replace(/%1/g, a).replace(/%2/g, b);
            }),
            (b.prototype.init = function () {
                var b = this;
                a(document).ready(function () {
                    b.enable(), b.build();
                });
            }),
            (b.prototype.enable = function () {
                var b = this;
                //disable lightbox
                // a('#flipbook-section').on(
                a('.flipbook-viewport-second').on(
                    'click',
                    'a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox-second], area[data-lightbox-second]',
                    function (c) {
                        console.log('flipbook-second clicked!')
                        // var scroll_pos=(0);
                        // $('html, body').animate({scrollTop:(scroll_pos)}, '2000');
                        return b.start(a(c.currentTarget)), !1;
                    }
                );
            }),
            (b.prototype.build = function () {
                if (!(a('#flipbook_lightbox_second').length > 0)) {
                    var b = this;
                    a(
                        '<div id="flipbook_lightboxOverlaySecon" tabindex="-1" class="lightboxOverlay"></div><div id="flipbook_lightbox_second" tabindex="-1" class="lightbox"><div class="flipbook-lb-outerContainer lb-outerContainer"><div class="flipbook-lb-container lb-container"><img class="flipbook-lb-image-second lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt=""/><div class="flipbook-img-text img-text"><div class="flipbook-lb-nav-second lb-nav"><a class="flipbook-lb-prev-second lb-prev" aria-label="Previous image" href="" ></a><a class="flipbook-lb-next-second lb-next" aria-label="Next image" href="" ></a></div><div class="flipbook-lb-loader-second lb-loader"><a class="flipbook-lb-cancel lb-cancel"></a></div></div></div><div class="flipbook-lb-dataContainer"><div class="flipbook-lb-data lb-data"><div class="flipbook-lb-details lb-details"><span class="flipbook-lb-caption-second lb-caption"></span><span class="flipbook-lb-number-second lb-number"></span></div><div class="flipbook-lb-closeContainer lb-closeContainer"><a class="flipbook-lb-close lb-close"></a></div></div></div></div>'
                    ).appendTo(a('#flipbook-section2')),
                        (this.$lightbox = a('#flipbook_lightbox_second')),
                        (this.$overlay = a('#flipbook_lightboxOverlaySecon')),
                        (this.$outerContainer = this.$lightbox.find('.flipbook-lb-outerContainer')),
                        (this.$container = this.$lightbox.find('.flipbook-lb-container')),
                        (this.$image = this.$lightbox.find('.flipbook-lb-image-second')),
                        (this.$nav = this.$lightbox.find('.flipbook-lb-nav-second')),
                        (this.containerPadding = {
                            top: parseInt(this.$container.css('padding-top'), 10),
                            right: parseInt(this.$container.css('padding-right'), 10),
                            bottom: parseInt(this.$container.css('padding-bottom'), 10),
                            left: parseInt(this.$container.css('padding-left'), 10),
                        }),
                        (this.imageBorderWidth = {
                            top: parseInt(this.$image.css('border-top-width'), 10),
                            right: parseInt(this.$image.css('border-right-width'), 10),
                            bottom: parseInt(this.$image.css('border-bottom-width'), 10),
                            left: parseInt(this.$image.css('border-left-width'), 10),
                        }),
                        this.$overlay.hide().on('click', function () {
                            return b.end(), !1;
                        }),
                        this.$lightbox.hide().on('click', function (c) {
                            'flipbook_lightbox_second' === a(c.target).attr('id') && b.end();
                        }),
                        this.$outerContainer.on('click', function (c) {
                            return 'flipbook_lightbox_second' === a(c.target).attr('id') && b.end(), !1;
                        }),
                        this.$lightbox.find('.flipbook-lb-prev-second').on('click', function () {
                            return (
                                0 === b.currentImageIndex ?
                                    b.changeImage(b.album.length - 1) :
                                    b.changeImage(b.currentImageIndex - 1),
                                    !1
                            );
                        }),
                        this.$lightbox.find('.flipbook-lb-next-second').on('click', function () {
                            return (
                                b.currentImageIndex === b.album.length - 1 ?
                                    b.changeImage(0) :
                                    b.changeImage(b.currentImageIndex + 1),
                                    !1
                            );
                        }),
                        this.$nav.on('mousedown', function (a) {
                            3 === a.which &&
                            (b.$nav.css('pointer-events', 'none'),
                                b.$lightbox.one('contextmenu', function () {
                                    setTimeout(
                                        function () {
                                            this.$nav.css('pointer-events', 'auto');
                                        }.bind(b),
                                        0
                                    );
                                }));
                        }),
                        this.$lightbox.find('.flipbook-lb-loader-second, .lb-close').on('click', function () {
                            return b.end(), !1;
                        });
                }
            }),
            (b.prototype.start = function (b) {
                function c(a) {
                    d.album.push({
                        alt: a.attr('data-alt'),
                        link: a.attr('href'),
                        title: a.attr('data-title') || a.attr('title'),
                    });
                }

                var d = this,
                    e = a(window);
                e.on('resize', a.proxy(this.sizeOverlay, this)), this.sizeOverlay(), (this.album = []);
                var f,
                    g = 0,
                    h = b.attr('data-lightbox-second');
                if (h) {
                    f = a(b.prop('tagName') + '[data-lightbox-second="' + h + '"]');
                    for (var i = 0; i < f.length; i = ++i) c(a(f[i])), f[i] === b[0] && (g = i);
                } else if ('flipbook_lightbox_second' === b.attr('rel')) c(b);
                else {
                    f = a(b.prop('tagName') + '[rel="' + b.attr('rel') + '"]');
                    for (var j = 0; j < f.length; j = ++j) c(a(f[j])), f[j] === b[0] && (g = j);
                }
                var k = e.scrollTop() + this.options.positionFromTop,
                    l = e.scrollLeft();
                this.$lightbox.css({
                    top: k + 'px',
                    left: l + 'px'
                }).fadeIn(this.options.fadeDuration),
                this.options.disableScrolling && a('#flipbook-section').addClass('lb-disable-scrolling'),
                    this.changeImage(g);
            }),
            (b.prototype.changeImage = function (b) {
                var c = this,
                    d = this.album[b].link,
                    e = d.split('.').slice(-1)[0],
                    f = this.$lightbox.find('.flipbook-lb-image-second');
                this.disableKeyboardNav(),
                    this.$overlay.fadeIn(this.options.fadeDuration),
                    a('.flipbook-lb-loader-second').fadeIn('slow'),
                    this.$lightbox
                        .find('.flipbook-lb-image-second, .flipbook-lb-nav-second, .flipbook-lb-prev-second, .flipbook-lb-next-second, .lb-dataContainer-second, .lb-numbers-second, .flipbook-lb-caption-second')
                        .hide(),
                    this.$outerContainer.addClass('animating');
                var g = new Image();
                (g.onload = function () {
                    var h, i, j, k, l, m;
                    f.attr({
                        alt: c.album[b].alt,
                        src: d
                    }),
                        a(g),
                        f.width(g.width),
                        f.height(g.height),
                        (m = a(window).width()),
                        (l = a(window).height()),
                        (k =
                            m -
                            c.containerPadding.left -
                            c.containerPadding.right -
                            c.imageBorderWidth.left -
                            c.imageBorderWidth.right -
                            20),
                        (j =
                            l -
                            c.containerPadding.top -
                            c.containerPadding.bottom -
                            c.imageBorderWidth.top -
                            c.imageBorderWidth.bottom -
                            c.options.positionFromTop -
                            70),
                    'svg' === e && (f.width(k), f.height(j)),
                        c.options.fitImagesInViewport ?
                            (c.options.maxWidth && c.options.maxWidth < k && (k = c.options.maxWidth),
                            c.options.maxHeight && c.options.maxHeight < j && (j = c.options.maxHeight)) :
                            ((k = c.options.maxWidth || g.width || k), (j = c.options.maxHeight || g.height || j)),
                    (g.width > k || g.height > j) &&
                    (g.width / k > g.height / j ?
                        ((i = k), (h = parseInt(g.height / (g.width / i), 10)), f.width(i), f.height(h)) :
                        ((h = j), (i = parseInt(g.width / (g.height / h), 10)), f.width(i), f.height(h))),
                        c.sizeContainer(f.width(), f.height());
                }),
                    (g.src = this.album[b].link),
                    (this.currentImageIndex = b);
            }),
            (b.prototype.sizeOverlay = function () {
                var b = this;
                setTimeout(function () {
                    b.$overlay.width(a(document).width()).height(a(document).height());
                }, 0);
            }),
            (b.prototype.sizeContainer = function (a, b) {
                function c() {
                    d.$lightbox.find('.lb-dataContainer-second').width(g),
                        d.$lightbox.find('.lb-prevLink').height(h),
                        d.$lightbox.find('.lb-nextLink').height(h),
                        d.$overlay.focus(),
                        d.showImage();
                }

                var d = this,
                    e = this.$outerContainer.outerWidth(),
                    f = this.$outerContainer.outerHeight(),
                    g =
                        a +
                        this.containerPadding.left +
                        this.containerPadding.right +
                        this.imageBorderWidth.left +
                        this.imageBorderWidth.right,
                    h =
                        b +
                        this.containerPadding.top +
                        this.containerPadding.bottom +
                        this.imageBorderWidth.top +
                        this.imageBorderWidth.bottom;
                e !== g || f !== h ?
                    this.$outerContainer.animate({
                            width: g,
                            height: h
                        },
                        this.options.resizeDuration,
                        'swing',
                        function () {
                            c();
                        }
                    ) :
                    c();
            }),
            (b.prototype.showImage = function () {
                this.$lightbox.find('.flipbook-lb-loader-second').stop(!0).hide(),
                    this.$lightbox.find('.flipbook-lb-image-second').fadeIn(this.options.imageFadeDuration),
                    this.updateNav(),
                    this.updateDetails(),
                    this.preloadNeighboringImages(),
                    this.enableKeyboardNav();
            }),
            (b.prototype.updateNav = function () {
                var a = !1;
                try {
                    document.createEvent('TouchEvent'), (a = !!this.options.alwaysShowNavOnTouchDevices);
                } catch (a) {
                }
                this.$lightbox.find('.flipbook-lb-nav-second').show(),
                this.album.length > 1 &&
                (this.options.wrapAround ?
                    (a && this.$lightbox.find('.flipbook-lb-prev-second, .flipbook-lb-next-second').css('opacity', '1'),
                        this.$lightbox.find('.flipbook-lb-prev-second, .flipbook-lb-next-second').show()) :
                    (this.currentImageIndex > 0 &&
                    (this.$lightbox.find('.flipbook-lb-prev-second').show(),
                    a && this.$lightbox.find('.flipbook-lb-prev-second').css('opacity', '1')),
                    this.currentImageIndex < this.album.length - 1 &&
                    (this.$lightbox.find('.flipbook-lb-next-second').show(),
                    a && this.$lightbox.find('.flipbook-lb-next-second').css('opacity', '1'))));
            }),
            (b.prototype.updateDetails = function () {
                var a = this;
                if (
                    void 0 !== this.album[this.currentImageIndex].title &&
                    '' !== this.album[this.currentImageIndex].title
                ) {
                    var b = this.$lightbox.find('.flipbook-lb-caption-second');
                    this.options.sanitizeTitle ?
                        b.text(this.album[this.currentImageIndex].title) :
                        b.html(this.album[this.currentImageIndex].title),
                        b.fadeIn('fast');
                }
                if (this.album.length > 1 && this.options.showImageNumberLabel) {
                    var c = this.imageCountLabel(this.currentImageIndex + 1, this.album.length);
                    this.$lightbox.find('.flipbook-lb-number-second').text(c).fadeIn('fast');
                } else this.$lightbox.find('.flipbook-lb-number-second').hide();
                this.$outerContainer.removeClass('animating'),
                    this.$lightbox.find('.lb-dataContainer-second').fadeIn(this.options.resizeDuration, function () {
                        return a.sizeOverlay();
                    });
            }),
            (b.prototype.preloadNeighboringImages = function () {
                if (this.album.length > this.currentImageIndex + 1) {
                    new Image().src = this.album[this.currentImageIndex + 1].link;
                }
                if (this.currentImageIndex > 0) {
                    new Image().src = this.album[this.currentImageIndex - 1].link;
                }
            }),
            (b.prototype.enableKeyboardNav = function () {
                this.$lightbox.on('keyup.keyboard', a.proxy(this.keyboardAction, this)),
                    this.$overlay.on('keyup.keyboard', a.proxy(this.keyboardAction, this));
            }),
            (b.prototype.disableKeyboardNav = function () {
                this.$lightbox.off('.keyboard'), this.$overlay.off('.keyboard');
            }),
            (b.prototype.keyboardAction = function (a) {
                var b = a.keyCode;
                27 === b ?
                    (a.stopPropagation(), this.end()) :
                    37 === b ?
                        0 !== this.currentImageIndex ?
                            this.changeImage(this.currentImageIndex - 1) :
                            this.options.wrapAround && this.album.length > 1 && this.changeImage(this.album.length - 1) :
                        39 === b &&
                        (this.currentImageIndex !== this.album.length - 1 ?
                            this.changeImage(this.currentImageIndex + 1) :
                            this.options.wrapAround && this.album.length > 1 && this.changeImage(0));
            }),
            (b.prototype.end = function () {
                this.disableKeyboardNav(),
                    a(window).off('resize', this.sizeOverlay),
                    this.$lightbox.fadeOut(this.options.fadeDuration),
                    this.$overlay.fadeOut(this.options.fadeDuration),
                this.options.disableScrolling && a('#flipbook-section').removeClass('lb-disable-scrolling');
            }),
            new b()
    );
});
